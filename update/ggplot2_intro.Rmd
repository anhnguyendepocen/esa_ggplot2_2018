---
title: "Data Visualization Using R & ggplot2"
author: "Naupaka Zimmerman (@naupakaz), Andrew Tredennick (@ATredennick), and Karthik Ram (@_inundata)"
date: "August 6, 2017"
output:
  beamer_presentation:
    theme: "metropolis"
    colortheme: "default"
    fig_caption: no
    slide_level: 2
---

```{r set-options, echo=FALSE, cache=FALSE}
options(size = "small")
```

## Some housekeeping
Install some packages
```{r house, echo=T, eval=F}
install.packages("ggplot2", dependencies = TRUE)
install.packages("ggthemes")
install.packages("tidyr")
install.packages("dplyr")
```

# Why ggplot?

## 1 minute
```{r gap, echo=F, eval=T}
library(ggplot2)
library(gapminder)
library(ggthemes)

ggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) +
  geom_point(shape = 1, aes(color = continent)) +
  stat_smooth(method = "lm", size = 1, color = "black") +
  scale_x_log10() + 
  xlab("Per Capita GDP") + 
  ylab("Life Expectancy (yrs)") +
  facet_wrap(~continent) +
  theme_few() + 
  guides(color = FALSE)
```

## 1 minute
```{r gap2, echo=T, eval=F}
library(ggplot2)
library(gapminder)
library(ggthemes)

ggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) +
  geom_point(shape = 1, aes(color = continent)) +
  stat_smooth(method = "lm", size = 1, color = "black") +
  scale_x_log10() + 
  xlab("Per Capita GDP") + 
  ylab("Life Expectancy (yrs)") +
  facet_wrap(~continent) +
  theme_few() + 
  guides(color = FALSE)
```

## 30 minutes
```{r gap3, echo=FALSE, eval=TRUE}
library(scales)
library(gapminder)
gapminder <- as.data.frame(gapminder)
conts <- unique(gapminder[,"continent"])
cols <- scales::hue_pal()(length(conts))
par(mfrow = c(2,3))
counter <- 1
for (i in conts) {
  plot(gapminder[which(gapminder$continent == i), "gdpPercap"],
       gapminder[which(gapminder$continent == i), "lifeExp"], col = cols[counter],
       xlab = "Per Capita GDP", ylab = "Life Expectancy (yrs)",
       main = i, las = 1, log = "x")
  fit <- lm(gapminder[which(gapminder$continent == i), "lifeExp"] ~ log(gapminder[which(gapminder$continent == i), "gdpPercap"]))
  pred <- predict(fit, interval = "confidence")
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,1]))
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,2]), lty = 2)
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,3]), lty = 2)
  counter <- counter + 1
}
```

## 30 minutes
```{r gap4, echo=T, eval=F}
library(scales)
library(gapminder)
gapminder <- as.data.frame(gapminder)
conts <- unique(gapminder[,"continent"])
cols <- scales::hue_pal()(length(conts))
par(mfrow = c(2,3))
counter <- 1
for (i in conts) {
  plot(gapminder[which(gapminder$continent == i), "gdpPercap"],
       gapminder[which(gapminder$continent == i), "lifeExp"], col = cols[counter],
       xlab = "Per Capita GDP", ylab = "Life Expectancy (yrs)",
       main = i, las = 1, log = "x")
  fit <- lm(gapminder[which(gapminder$continent == i), "lifeExp"] ~ 
```

## But wait, there's more...
```{r gap5, echo=T, eval=F}
log(gapminder[which(gapminder$continent == i), "gdpPercap"]))
  pred <- predict(fit, interval = "confidence")
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,1]))
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,2]), lty = 2)
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,3]), lty = 2)
  counter <- counter + 1
}
```


# Why ggplot?

##  Why ggplot?
* More elegant and compact code than with base graphics
* More aesthetically pleasing defaults than lattice
* Very powerful for exploratory data analysis

## Why ggplot?
* \alert{gg} is for \alert{grammar of graphics} (term by Lee Wilkinson)
* A set of terms that defines the basic components of a plot
* Used to produce figures using coherant, consistant syntax

##  Why ggplot2?
* Supports a continuum of expertise
* Easy to get started, plenty of power for complex figures 


# The Grammar

##  Some terminology
### Data
* Must be a data frame (```data.frame()```, ```as.data.frame()```)
* Gets pulled into the ```ggplot()``` object

##  A quick example
### The \alert{iris} dataset
```{r irishead, eval=T, echo=T}
head(iris)
```

##  tidyr
Helps your data play nice with ggplot

##  tidyr
```{r iris-tidy, echo=T, eval=T}
iris[1:2, ]

library(tidyr)
df <- gather(iris, key = flower_attribute, 
             value = measurement, -Species)
df[1:2, ]
```


# Aesthetics

## Some terminology
### \alert{aes}thetics
* How your data are represented visually 
  + a.k.a. mapping
* which data on the x
* which data on the y
* but also: \textcolor{red}{color}, \LARGE{size}, \normalsize{shape, transparency}

##  An example
```{r empty-gg, eval=T, echo=T}
myplot <- ggplot(data = iris, aes(x = Sepal.Length, 
                                  y = Sepal.Width))
summary(myplot)

```
